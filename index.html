<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>PXT Investimentos - Cadastro</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      width: 100%;
      max-width: 400px;
      padding: 20px;
      background-color: #111;
      border-radius: 12px;
      box-shadow: 0 0 20px #222;
    }
    input, button {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
    }
    input {
      background-color: #222;
      color: #fff;
    }
    button {
      background-color: #0f0;
      color: #000;
      cursor: pointer;
    }
    #app {
      display: none;
    }
    .config-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #444;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="cadastro" class="container">
  <h2>Cadastro - PXT Investimentos</h2>
  <input type="text" id="nome" placeholder="Nome completo">
  <input type="text" id="telefone" placeholder="Telefone">
  <button onclick="criarConta()">Criar</button>
</div>

<div id="app" class="container">
  <div class="config-btn" onclick="abrirConfiguracoes()">⚙️</div>
  <h2>Bem-vindo à sua conta</h2>
  <p><strong>Saldo:</strong> <span id="saldo">0</span> PXT-Coin</p>
  <p><strong>Sua chave de pagamento:</strong></p>
  <p id="chavePix" style="word-break: break-all;"></p>
  <h3>Fazer pagamento</h3>
  <input type="text" id="chaveDestino" placeholder="Chave de pagamento do destinatário">
  <input type="number" id="valor" placeholder="Valor a enviar">
  <button onclick="pagar()">Enviar</button>
</div>

<div id="configuracoes" class="container" style="display:none;">
  <h2>Configurações</h2>
  <button onclick="voltar()">Voltar</button>
  <button onclick="mudarNome()">Mudar nome (a cada 7 dias)</button>
  <button onclick="excluirConta()">Excluir conta</button>
</div>

<script>
  let usuarios = JSON.parse(localStorage.getItem('usuarios') || '{}');
  let usuarioAtual = JSON.parse(localStorage.getItem('usuarioAtual') || 'null');

  function gerarChave() {
    return 'pxt-' + Math.random().toString(36).substring(2, 10) + Date.now();
  }

  function criarConta() {
    const nome = document.getElementById('nome').value.trim();
    const telefone = document.getElementById('telefone').value.trim();

    if (!nome || !telefone) return alert('Preencha todos os campos');
    if (usuarios[nome]) return alert('Esse nome já está em uso');

    const chave = gerarChave();
    const novoUsuario = {
      nome,
      telefone,
      chave,
      saldo: 1,
      ultimaMudancaNome: Date.now()
    };

    usuarios[nome] = novoUsuario;
    localStorage.setItem('usuarios', JSON.stringify(usuarios));

    localStorage.setItem('usuarioAtualNome', nome);
    mostrarApp();
  }

  function mostrarApp() {
    const nome = localStorage.getItem('usuarioAtualNome');
    if (!nome || !usuarios[nome]) return;

    usuarioAtual = usuarios[nome];
    document.getElementById('cadastro').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    document.getElementById('saldo').innerText = usuarioAtual.saldo.toFixed(2);
    document.getElementById('chavePix').innerText = usuarioAtual.chave;
  }

  function pagar() {
    const chave = document.getElementById('chaveDestino').value.trim();
    const valor = parseFloat(document.getElementById('valor').value);

    if (!chave || isNaN(valor) || valor <= 0) return alert('Dados inválidos');
    if (valor > usuarioAtual.saldo) return alert('Saldo insuficiente');

    let destinoNome = null;
    for (const nome in usuarios) {
      if (usuarios[nome].chave === chave) {
        destinoNome = nome;
        break;
      }
    }

    if (!destinoNome) return alert('Chave de pagamento incorreta');

    usuarios[destinoNome].saldo += valor;
    usuarios[usuarioAtual.nome].saldo -= valor;

    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    mostrarApp();
    alert('Pagamento realizado com sucesso');
  }

  function abrirConfiguracoes() {
    document.getElementById('app').style.display = 'none';
    document.getElementById('configuracoes').style.display = 'block';
  }

  function voltar() {
    document.getElementById('configuracoes').style.display = 'none';
    mostrarApp();
  }

  function mudarNome() {
    const novoNome = prompt('Novo nome completo:').trim();
    const agora = Date.now();

    if (!novoNome) return alert('Nome inválido');
    if (usuarios[novoNome]) return alert('Nome já está em uso');
    if (agora - usuarioAtual.ultimaMudancaNome < 7 * 24 * 60 * 60 * 1000) return alert('Você só pode mudar de nome a cada 7 dias');

    delete usuarios[usuarioAtual.nome];
    usuarioAtual.nome = novoNome;
    usuarioAtual.ultimaMudancaNome = agora;
    usuarios[novoNome] = usuarioAtual;

    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    localStorage.setItem('usuarioAtualNome', novoNome);
    alert('Nome alterado com sucesso');
    mostrarApp();
  }

  function excluirConta() {
    if (!confirm('Tem certeza? Isso apagará sua conta.')) return;
    delete usuarios[usuarioAtual.nome];
    localStorage.removeItem('usuarioAtualNome');
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    location.reload();
  }

  if (localStorage.getItem('usuarioAtualNome')) mostrarApp();
</script>

</body>
</html>
